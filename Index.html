<html>

<head>
	<title>Time Sheet</title>
</head>

<body>
	<p>Time Sheet</p>
	<!-- Main TimeSheet Page -->
	<div class="Page" id="Main_Page">
		<form action="">
			<table border=1 id="TimeSheetTable_ID">
				<tr>
					<th>Date</th>
					<th>Hours</th>
					<th>Project Name</th>
					<th>Project DT</th>
					<th>Description</th>
				</tr>
			</table>
			<input type="button" name="TimeSheetAddRowBtn" id="TimeSheetAddRowBtn_ID" onclick="AddRowFunc()"
				value="Add entry">
			<input type="button" name="TimeSheetUpdateBtn" id="TimeSheetUpdateBtn_ID" value="Update">
		</form>
	</div>
	<!-- Page Selector -->
	<div>
		<label for="NewProjectDTField_ID">Project DT</label>
		<input type="text" name="NewProjectDTField" id="NewProjectDTField_ID" placeholder="DT-nnnnnn" pattern="(^DT|^C{2})-[0-9]{5,6}" required>
		<p id="NewProjectDTWarrning_ID" style="color: red; visibility: hidden;">==>The DT must have the following format DT(or CC)-123456(or 12345) <==</p></br>

		<label for="NewProjectNameField_ID">Project Name</label>
		<input type="text" name="NewProjectNameField" id="NewProjectNameField_ID" placeholder="project-id" pattern ="^([a-zA-Z]+)_([0-9a-zA-Z]+){3}" required>
		<p id="NewProjectNameWarrning_ID" style="color: red;visibility: hidden;">==>The Project name must follow the format : name_id (id must have minimum 3 leters) <==</p></br>

		<input type="button" name="NewProjectBtn" id="NewProjectBtn_ID" onclick="AddProjectFunc()" value="Add Project">
	</div>
	<p id="debug_test">Debug</p>

	<script>
		/*Table related information.*/
		var Table = document.getElementById("TimeSheetTable_ID");
		var TableColumnCount = Table.rows[0].cells.length;

		/*Debug field ==> has to be removed.*/
		var Debug_text_filed = document.getElementById("debug_test");

		/*Date information needed for validation rules.*/
		var date = new Date();
		var last_day = new Date(date.getFullYear(), (date.getMonth() + 1), 0);

		first_day_of_the_month = date.getFullYear() + "-0" + (date.getMonth() + 1) + "-01";
		last_day_of_the_month = date.getFullYear() + "-0" + (date.getMonth() + 1) + "-" + last_day.getDate();
		Current_date = date.getFullYear() + "-0" + (date.getMonth() + 1) + "-" + date.getDate();

		/*Container and name count for Project names and DT names.*/
		var Projects_Map = new Map();
		var ProjectNameCount = 0;
		var Global_ProjectName_List = document.createElement("select");

		/*Add constraint rules.*/
		var New_DT_Name_input = document.getElementById("NewProjectDTField_ID");
		var New_DT_Name_warrning = document.getElementById("NewProjectDTWarrning_ID");
		var New_Project_Name_input = document.getElementById("NewProjectNameField_ID");
		var New_Project_Name_warrning = document.getElementById("NewProjectNameWarrning_ID");

		/*Check the input text, if its not ok signal it with a red background and warning message.*/
		New_DT_Name_input.addEventListener('input',function(event){
			if(!New_DT_Name_input.validity.valid)
			{
				New_DT_Name_input.style.backgroundColor = "red";
				New_DT_Name_warrning.style.visibility = "visible";
				console.log('not ok');
			}
			else
			{
				New_DT_Name_input.style.backgroundColor = "white";
				New_DT_Name_warrning.style.visibility = "hidden";
				console.log('ok');
			}
		});

		/*If input was written incorrectly the text will be removed.*/
		New_DT_Name_input.addEventListener('blur',function(event){
			if(!New_DT_Name_input.validity.valid)
			{
				New_DT_Name_input.value = "";
				New_DT_Name_input.style.backgroundColor = "white";
				New_DT_Name_warrning.style.visibility = "hidden";
			}
			else
			{
				/*Nothing to do*/
			}
		});
		/*Similar procedure for the project name input.*/
		New_Project_Name_input.addEventListener('input',function(event){
			if(!New_Project_Name_input.validity.valid)
			{
				New_Project_Name_input.style.backgroundColor = "red";
				New_Project_Name_warrning.style.visibility = "visible";
				console.log('not ok');
			}
			else
			{
				New_Project_Name_input.style.backgroundColor = "white";
				New_Project_Name_warrning.style.visibility = "hidden";
				console.log('ok');
			}
		});

		New_Project_Name_input.addEventListener('blur',function(event){
			if(!New_Project_Name_input.validity.valid)
			{
				New_Project_Name_input.value = "";
				New_Project_Name_input.style.backgroundColor = "white";
				New_Project_Name_warrning.style.visibility = "hidden";
			}
			else
			{
				/*Nothing to do*/
			}
		});



		/*Row adding functionality*/
		function AddRowFunc() {
			/*Start a new row element*/
			var NewTableRowElement = document.createElement("tr");

			/*Append data to new row.*/
			Table.appendChild(NewTableRowElement);
			for (i = 0; i < TableColumnCount; i++) {
				NewTableRowElement.appendChild(document.createElement("td"));
			}
			/*Add calendar input for date, with validation rules.*/
			NewTableRowElement.childNodes[0].appendChild(document.createElement("input"));
			NewTableRowElement.childNodes[0].childNodes[0].setAttribute("type", "date");
			NewTableRowElement.childNodes[0].childNodes[0].setAttribute("value", Current_date);
			NewTableRowElement.childNodes[0].childNodes[0].setAttribute("min", first_day_of_the_month);
			NewTableRowElement.childNodes[0].childNodes[0].setAttribute("max", last_day_of_the_month);

			/*Add number input for hours, with validation rules.*/
			NewTableRowElement.childNodes[1].appendChild(document.createElement("input"));
			NewTableRowElement.childNodes[1].childNodes[0].setAttribute("type", "number");
			NewTableRowElement.childNodes[1].childNodes[0].setAttribute("value", "8");
			NewTableRowElement.childNodes[1].childNodes[0].setAttribute("min", "0");
			NewTableRowElement.childNodes[1].childNodes[0].setAttribute("max", "20");

			/*Add selector element for project names. It will be cloned after a globar selector.*/		
			ProjectNameFormat_txt = "ProjectName_" + (Table.rows.length - 2) + "_ID";

			NewTableRowElement.childNodes[2].appendChild(Global_ProjectName_List.cloneNode(true));
			NewTableRowElement.childNodes[2].childNodes[0].setAttribute("class", "ProjectName");
			NewTableRowElement.childNodes[2].childNodes[0].setAttribute("id", ProjectNameFormat_txt);
			NewTableRowElement.childNodes[2].childNodes[0].setAttribute("onchange", "AlignProjectDataFunc(event,'" + ProjectNameFormat_txt + "')");

			/*Complete project DT name data according to the Project name selector.*/
			NewTableRowElement.childNodes[3].innerHTML = Projects_Map.get(NewTableRowElement.childNodes[2].childNodes[0].value);
			NewTableRowElement.childNodes[3].setAttribute("class", "ProjectNameDT");
			NewTableRowElement.childNodes[3].setAttribute("id", "ProjectNameDT_" + (Table.rows.length - 2) + "_ID");

			/*Add text input, for the description field.*/
			NewTableRowElement.childNodes[4].appendChild(document.createElement("input"));
			NewTableRowElement.childNodes[4].childNodes[0].setAttribute("type", "text");
		}
		/*Project adding functionality.*/
		function AddProjectFunc() {
			var New_Project_DT = document.getElementById("NewProjectDTField_ID").value;
			var New_Project_Name = document.getElementById("NewProjectNameField_ID").value;
			var ProjectNameList = document.getElementsByClassName("ProjectName");
			var ProjectDTList = document.getElementsByClassName("ProjectNameDT");

			Projects_Map.set(New_Project_Name, New_Project_DT);

			Global_ProjectName_List.appendChild(document.createElement("option"));
			Global_ProjectName_List.childNodes[ProjectNameCount].setAttribute("value", New_Project_Name);
			Global_ProjectName_List.childNodes[ProjectNameCount].innerHTML = New_Project_Name;

			if (ProjectNameList.length > 0) {
				for (i = 0; i < (Table.rows.length - 1); i++) {
					ProjectNameList[i].appendChild(document.createElement("option"));
					ProjectNameList[i].childNodes[ProjectNameCount].setAttribute("value", New_Project_Name);
					ProjectNameList[i].childNodes[ProjectNameCount].innerHTML = New_Project_Name;
				}
			}
			ProjectNameCount++;
		}
		/*Function for aligning DT name and project name.*/
		function AlignProjectDataFunc(e, event_source) {
			/*Create a list and a string variable for the id name change.*/
			var source_list = [];
			var new_source_list = "";

			/*Change the id name received from the argument with its DT pair.*/
			source_list = event_source.split('_')
			source_list[0] = "ProjectNameDT"
			new_source_list = source_list.join('_');

			/*Set the DT value according to the selected project name.*/
			var Selected_Element_Name = document.getElementById(event_source);
			var Element_2B_Modified = document.getElementById(new_source_list);
			Element_2B_Modified.innerHTML = Projects_Map.get(Selected_Element_Name.value);
		}
	</script>
</body>

</html>